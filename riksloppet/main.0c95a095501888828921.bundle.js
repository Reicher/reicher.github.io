/*! For license information please see main.0c95a095501888828921.bundle.js.LICENSE.txt */
(()=>{var e,t={164:(e,t,s)=>{"use strict";var i=s(260),n=s.n(i);class a extends Phaser.Scene{constructor(){super({key:"PostScene"})}create(){console.log("Game over"),this.add.sprite(0,0,"postGame").setOrigin(0),this.input.on("pointerdown",(()=>{this.scene.start("TitleScene")}),this),this.input.keyboard.addKey("space").on("down",(()=>{this.scene.start("TitleScene")}),this)}}class o extends Phaser.Scene{constructor(){super({key:"TitleScene"}),this.isClicking=!1}create(){console.log("PreGame"),this.cursors=this.input.keyboard.createCursorKeys(),this.add.sprite(0,0,"title").setOrigin(0),this.input.on("pointerdown",(()=>{this.scene.start("GameTypeSelectScene")}),this),this.input.keyboard.addKey("space").on("down",(()=>{this.scene.start("GameTypeSelectScene")}),this)}}class r extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.spritesheet("c_run","assets/img/Annie_spring-Sheet.png",{frameWidth:40,frameHeight:80}),this.load.spritesheet("c_stopp","assets/img/Annie_stopp-Sheet.png",{frameWidth:40,frameHeight:80}),this.load.spritesheet("c_slag","assets/img/Annie_slag-Sheet.png",{frameWidth:40,frameHeight:80}),this.load.spritesheet("c_krock","assets/img/Annie_krock-Sheet.png",{frameWidth:40,frameHeight:80}),this.load.image("c_porträtt","assets/img/Annie_porträtt.png"),this.load.image("kd_porträtt","assets/img/Ebba_porträtt.png"),this.load.image("v_porträtt","assets/img/Nooshi_porträtt.png"),this.load.image("sd_porträtt","assets/img/Jimmie_porträtt.png"),this.load.image("logo","assets/img/tns-logo.png"),this.load.image("välj","assets/img/välj.png"),this.load.spritesheet("statist","assets/img/statist.png",{frameWidth:89,frameHeight:100}),this.load.spritesheet("åskådare_kille_kast","assets/img/åskådare_kille_kast-Sheet.png",{frameWidth:40,frameHeight:80}),this.load.image("åskådare_kille","assets/img/åskådare_kille_bära.png"),this.load.image("gata","assets/img/Gata.png"),this.load.image("himmel","assets/img/Himmel och skyline.png"),this.load.image("förgrund1","assets/img/Förgrund1.png"),this.load.image("förgrund2","assets/img/Förgrund2.png"),this.load.image("splash","assets/img/splash.png"),this.load.image("title","assets/img/titel.png"),this.load.image("levelSetting","assets/img/levelSettings.png"),this.load.image("char_text","assets/img/char_text.png"),this.load.image("postGame","assets/img/postGame.png"),this.load.image("game_type_select","assets/img/GameTypeSelectScreen.png"),this.load.image("bil","assets/img/Blå bil.png"),this.load.image("bil_röd","assets/img/parkerad_bil_röd.png"),this.load.image("peng","assets/img/Peng.png"),this.load.image("neddut","assets/img/neddut.png")}create(){console.log("PreLoad"),this.scene.start("SplashScene")}}class c extends Phaser.Scene{constructor(){super({key:"SplashScene"}),this.fade_time=1e3}create(){console.log("Splash"),this.cursors=this.input.keyboard.createCursorKeys(),this.add.sprite(480,270,"logo").setScale(2),this.cameras.main.once("camerafadeincomplete",(function(e){e.fadeOut(e.scene.fade_time)})),this.cameras.main.once("camerafadeoutcomplete",(function(e){e.scene.scene.start("TitleScene")})),this.input.on("pointerdown",(()=>{this.scene.start("TitleScene")}),this),this.input.keyboard.addKey("space").on("down",(()=>{this.scene.start("TitleScene")}),this),this.cameras.main.fadeIn(this.fade_time)}}class l{constructor(){}static addElement(...e){e.forEach((e=>{this.screens[this.screenIndex].push(e),e.attatch()}))}static addScreen(){this.hideScreen(),this.screens.push([...this.screens[this.screenIndex]]),this.screenIndex++,this.screens.push([])}static hideScreen(){this.screens[this.screenIndex].forEach((e=>e.hide()))}static showScreen(){this.screens[this.screenIndex].forEach((e=>e.show()))}static clearScreen(){this.screens[this.screenIndex].forEach((e=>e.destroy()))}static removeScreen(){const e=this.screens.pop();e&&e.forEach((e=>e.destroy())),this.screenIndex--,this.screenIndex<0&&(this.screenIndex=0,this.screens.push([])),this.showScreen()}}l.screenIndex=0,l.screens=[[]];class h extends Phaser.Scene{constructor(){super({key:"LevelSelectScene"})}create(){l.clearScreen();const e={type:"SinglePlayer",player:{clientId:"UNKNOWN",clientName:"UNKNOWN",isHost:!1}};console.log("LevelSelectScene"),this.cursors=this.input.keyboard.createCursorKeys(),this.add.sprite(0,0,"levelSetting").setOrigin(0),this.input.on("pointerdown",(()=>{this.scene.start("CharSelectScene",e)}),this),this.input.keyboard.addKey("space").on("down",(()=>{this.scene.start("CharSelectScene",e)}),this)}}class d{constructor(){}setPosition(e){this.setStyle((({fromCenter:e,x:t,y:s,relative:i})=>i?{}:{position:"absolute",top:e?`calc(50% - ${s}px)`:`${s}px`,left:e?`calc(50% - ${t}px)`:`${t}px`,transform:"translate(-50%, -50%)"})(Object.assign({x:0,y:0,fromCenter:!1,relative:!1},e)))}attatch(e=document.documentElement){this.parent=e,e.appendChild(this.element)}destroy(){this.element.remove()}onClick(e){this.element.addEventListener("click",e)}show(){this.setStyle({opacity:"1",pointerEvents:"auto",touchAction:"auto"})}hide(){this.setStyle({opacity:"0",pointerEvents:"none",touchAction:"none"})}setStyle(...e){Object.assign(this.element.style,...e)}}const p=e=>({border:`5px solid ${e}`,backgroundColor:"transparent",color:e}),u={borderRadius:"10px",margin:"0px",padding:"20px 30px",fontSize:"64px",fontWeight:"bold",cursor:"pointer",transition:"all .25s ease"};class m extends d{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){const s=document.createElement("button");s.innerText=e,this.element=s,this.setStyle(u,p(t)),s.addEventListener("mouseenter",(()=>this.setStyle((e=>({backgroundColor:e,color:"white"}))(t)))),s.addEventListener("mouseleave",(()=>this.setStyle(p(t))))}}const y={display:"grid",gap:"16px"};class g extends d{constructor(e,t){super(),this.rows=e,this.columns=t,this.maxChildren=1/0,this.initialize()}initialize(){const e=document.createElement("div");this.element=e,this.setStyle(y),"auto"!==this.columns&&this.setStyle({gridTemplateColumns:`repeat(${this.columns}, 1fr)`}),"auto"!==this.rows&&this.setStyle({gridTemplateRows:`repeat(${this.rows}, 1fr)`}),"number"==typeof this.columns&&"number"==typeof this.rows&&(this.maxChildren=this.columns*this.rows)}addElement(...e){e.forEach((e=>{e.attatch(this.element)})),this.element.childElementCount>this.maxChildren&&console.warn("UI Grid reached max amount of children, layout may be affected!")}}class f extends d{constructor(e=!1){super(),this.initialize(e)}initialize(e){const t=document.createElement("div");this.element=t,this.setStyle((e=>({display:"flex",flexDirection:e?"row":"column",rowGap:"16px",columnGap:"16px",maxWidth:"600px",width:"100%"}))(e))}addElement(...e){e.forEach((e=>{e.attatch(this.element)}))}}var w;!function(e){e.SOCIALDEMOKRAT="Maggan",e["MILJÖPARTIST"]="PerOMär",e.SVERIGEDEMOKRAT="Jimmie",e.MODERAT="Uffe",e.LIBERAL="Nyam",e.KRISTDEMOKRAT="Ebba",e.CENTERPARTIST="Annie",e["VÄNSTERPARTIST"]="Nooshi"}(w||(w={}));const S={[w.KRISTDEMOKRAT]:{x:150,y:50},[w.VÄNSTERPARTIST]:{x:50,y:50},[w.CENTERPARTIST]:{x:100,y:50},[w.SVERIGEDEMOKRAT]:{x:200,y:50},[w.SOCIALDEMOKRAT]:{x:150,y:150},[w.LIBERAL]:{x:50,y:150},[w.MILJÖPARTIST]:{x:100,y:150},[w.MODERAT]:{x:200,y:150}},k=e=>{switch(e){case"kd":return w.KRISTDEMOKRAT;case"c":return w.CENTERPARTIST;case"v":return w.VÄNSTERPARTIST;case"sd":return w.SVERIGEDEMOKRAT;default:return v()}},C=e=>{switch(e){case w.CENTERPARTIST:return"c";case w.KRISTDEMOKRAT:return"kd";case w.SVERIGEDEMOKRAT:return"sd";case w.VÄNSTERPARTIST:default:return"v"}},x=e=>{switch(e){case"kd":return"#005ea1";case"c":return"#114838";case"v":return"#ed1c24";case"sd":return"#1f135b";default:return"black"}},v=()=>{const e=Phaser.Math.Between(0,Object.values(w).length-1);return Object.values(w)[e]};class b extends d{constructor({width:e,height:t,source:s,sizing:i}){super(),this.width=e,this.height=t,this.source=s,this.sizing=i,this.initialize()}initialize(){const e=document.createElement("img");this.element=e,e.src=this.source;const t="number"==typeof this.width?`${this.width}px`:this.width,s="number"==typeof this.height?`${this.height}px`:this.height;this.setStyle({width:t,height:s,objectFit:this.sizing})}}const P="100%",I={filter:"grayscale(100%)",cursor:"pointer"},E={filter:"none"},T=e=>`assets/img/${k(e)}_porträtt.png`;class _ extends b{constructor(e){super({width:P,height:P,sizing:"contain",source:T(e)}),this.parti=e,this.element.tabIndex=0,this.setStyle(I,{transition:"filter .25s ease"}),this.setupListener()}setupListener(){this.element.addEventListener("mouseenter",(()=>{this.setStyle(E)})),this.element.addEventListener("mouseleave",(()=>{this.isActive||this.setStyle(I)}))}setActive(e){this.isActive=e,e?this.setStyle(E):this.setStyle(I)}}class H extends d{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){const s=document.createElement("heading"===t?"h1":"p");s.innerText=e,Object.assign(s.style,(e=>({color:"white",fontSize:"heading"===e?"98px":"49px",fontWeight:"heading"===e?"bold":"normal",fontFamily:"Monospace",margin:"0px",lineHeight:"1"}))(t)),this.element=s}setText(e){this.element.innerText=e}}class N extends Phaser.Scene{constructor(){super({key:"CharSelectScene"}),this.partinamn=["kd","c","v","sd"]}init(){}create(e){console.log("CharSelectScene"),l.clearScreen();const t=new f;t.setPosition({fromCenter:!0});const s=new g(2,4),i=new m("Välj","#06D6A0");i.onClick((()=>{this.selectedPortätt?(e.player.parti=this.selectedPortätt.parti,"Multiplayer"===e.type?(this.scene.start("LobbyScene",e),e.playersHandler.selectParti(this.selectedPortätt.parti)):this.scene.start("MainScene",e)):console.error("No selected parti!")})),i.hide();for(let e=0;e<8;e++){const t=this.partinamn[e%this.partinamn.length],n=new _(t);n.onClick((()=>{this.selectedPortätt&&this.selectedPortätt.setActive(!1),this.selectedPortätt=n,n.setActive(!0),i.show()})),s.addElement(n)}t.addElement(new H("Välj din löpare!","heading"),s,i),l.addElement(t)}update(){}}class R extends Phaser.Scene{constructor(){super({key:"GameTypeSelectScene"})}create(){console.log("GameTypeSelectScene");const e=new m("Single player","#3185FC");e.setPosition({y:100,fromCenter:!0}),e.onClick((()=>{this.scene.start("LevelSelectScene")}));const t=new m("Multiplayer","#06D6A0");t.setPosition({y:-100,fromCenter:!0}),t.onClick((()=>{this.scene.start("ServerConnectionScene")})),l.addElement(e,t)}}class O extends Phaser.Scene{constructor(){super({key:"LobbyScene"})}create(e){this.context=e,this.players={},this.clientsGroup=new f,e.playersHandler.getConnectedPlayers(!1).forEach(this.addPlayer.bind(this)),e.playersHandler.onNewPlayer=this.addPlayer.bind(this),e.playersHandler.onRemovePlayer=this.removePlayer.bind(this),this.context.networkClient.isHost?this.createHostedLobby():this.joinLobby()}createHostedLobby(){var e;l.clearScreen();const t=new f;l.addElement(t),t.setPosition({fromCenter:!0});const s=new H(`${this.context.player.clientName}'s Lobby`,"heading"),i=new H(null===(e=this.context.networkClient)||void 0===e?void 0:e.roomId,"heading"),n=new H("---------------------------------------------------","normal"),a=new m("Starta spelet","#06D6A0");a.onClick((()=>{this.context.networkClient.lockRoom(),this.context.networkClient.sendData({type:4,payload:[]}),this.scene.start("MainScene",this.context)})),t.addElement(s,i,n,this.clientsGroup,a)}joinLobby(){var e;l.clearScreen();const t=new f;l.addElement(t),t.setPosition({fromCenter:!0});const s=new H("Lobby","heading"),i=new H(null===(e=this.context.networkClient)||void 0===e?void 0:e.roomId,"heading"),n=new H("---------------------------------------------------","normal");t.addElement(s,i,n,this.clientsGroup);const a=e=>{4===e.type&&(this.scene.start("MainScene",this.context),this.context.networkClient.off("game-data",a))};this.context.networkClient.on("game-data",a)}removePlayer(e){this.players[e.clientId].destroy()}addPlayer(e){const t=new f(!0),s=new b({width:150,height:150,sizing:"contain",source:T(e.parti)}),i=new H(e.clientName,"normal");t.addElement(s,i),this.players[e.clientId]=t,this.clientsGroup.addElement(t)}}class A extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,n){if(super(e,t,s,i),e.anims.create({key:"smält",frameRate:20,frames:this.anims.generateFrameNumbers("statist",{start:0,end:8}),repeat:0}),e.anims.create({key:"kasta",frameRate:15,frames:this.anims.generateFrameNumbers("åskådare_kille_kast",{start:0,end:4}),repeat:0}),e.add.existing(this),e.physics.add.existing(this),this.setBodySize(30,30),this.body.setOffset(10,50),this.depth=this.y,n){this.powerup=n;let t=0;t=s<400?Phaser.Math.Between(this.y+50,500):Phaser.Math.Between(200,this.y-50),this.powerup.depth=this.y,e.physics.add.existing(this),this.setFrame(4),this.powerup_tween=this.scene.tweens.add({targets:this.powerup,y:{from:this.powerup.y,to:t},ease:"Linear",duration:1e3,paused:!0}),e.time.addEvent({delay:Phaser.Math.Between(500,5600),callback:this.kasta,callbackScope:this})}}kasta(){this.powerup&&(this.play("kasta",!0),this.powerup_tween.play())}collidedWith(e){e.knockOut(),this.destroy()}destroy(){this.powerup&&this.powerup.destroy(!0),this.play("smält",!0),this.once("animationcomplete",(()=>{super.destroy()}))}update(...e){this.powerup.depth=this.powerup.y}}class M{constructor(e,t,s,i,a,o){this.next_hinder=0,this.next_statist_uppe=0,this.next_statist_nere=0,this.scene=e,this.length=t,this.difficulty=s,this.statist=i,this.hinder=a,this.powerup=o,e.physics.world.setBounds(0,140,t+100,e.HEIGHT-140),e.physics.world.setBoundsCollision(),e.add.tileSprite(0,0,t,e.HEIGHT,"himmel").setOrigin(0).setScrollFactor(.6),e.add.tileSprite(0,0,t,e.HEIGHT,"gata").setOrigin(0).setScrollFactor(1);let r=e.add.tileSprite(0,e.HEIGHT-100,e.goal,e.HEIGHT,"förgrund2");r.setOrigin(0).setScrollFactor(1.5),r.depth=e.WIDTH+10;let c=e.add.tileSprite(0,e.HEIGHT-100,t,e.HEIGHT,"förgrund1");c.setOrigin(0).setScrollFactor(2),c.depth=e.WIDTH+11;for(let t=e.WIDTH;t>400;t-=n().Math.Between(60,130))this.createStatist(t,170);for(let t=e.WIDTH;t>400;t-=n().Math.Between(60,130))this.createStatist(t,this.scene.HEIGHT-30)}createHinder(e){let t=this.hinder.create(e,n().Math.Between(this.scene.STREET_MIN_Y,this.scene.STREET_MAX_Y),"bil_röd");t.setImmovable(!0),t.setBodySize(170,50),t.body.setOffset(0,50),t.setOrigin(0,.5),t.depth=t.y}createStatist(e,t){let s=null;n().Math.RND.frac()>.8&&(s=n().Math.RND.frac()>.5?this.powerup.create(e,t-75,"peng").setOrigin(.5,1):this.powerup.create(e,t-75,"neddut").setOrigin(.5,1));let i=n().Math.RND.pick(["åskådare_kille","åskådare_kille"]),a=new A(this.scene,e,t,i,s);this.statist.add(a,!0),a.setOrigin(.5,1)}update(e,t,s){s>this.next_hinder&&(this.next_hinder=s+n().Math.Between(200,600),this.createHinder(s)),s>this.next_statist_uppe&&(this.next_statist_uppe=s+n().Math.Between(60,130),this.createStatist(s,170)),s>this.next_statist_nere&&(this.next_statist_nere=s+n().Math.Between(60,130),this.createStatist(s,this.scene.HEIGHT-30))}}class D extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,"c_stopp"),this.max_speed=8,this.rest_speed=8,this.knocked_out=0,this.slår=!1,this.key=i,e.anims.create({key:"spring",frameRate:20,frames:e.anims.generateFrameNumbers("c_run",{start:0,end:11}),repeat:-1}),e.anims.create({key:"stopp",frameRate:40,frames:e.anims.generateFrameNumbers("c_stopp",{start:0,end:5}),repeat:0}),e.anims.create({key:"slag",frameRate:30,frames:e.anims.generateFrameNumbers("c_slag",{start:0,end:5}),repeat:0}),e.physics.add.existing(this),e.add.existing(this),this.setBodySize(30,30),this.body.setOffset(10,50)}slå(){this.slår||(this.slår=!0,this.anims.play("slag"),this.scene.time.addEvent({delay:500,callback:()=>{this.slår=!1},callbackScope:this,loop:!1}))}knockOut(){this.knocked_out=1}getSpeedFromDir(e,t){let s=Math.abs(Math.sqrt(e*e+t*t));return 0==s&&(s=1),[e/s*this.max_speed,t/s*this.max_speed]}update(e,t,s){this.max_speed>this.rest_speed?this.max_speed-=t/1e3:this.max_speed<this.rest_speed&&(this.max_speed+=t/1e3);let i=this.getSpeedFromDir(s[0],s[1]);0!=i[0]||0!=i[1]?this.anims.play("spring",!0):this.anims.currentAnim&&"stopp"!=this.anims.currentAnim.key&&this.anims.play("stopp",!0),i[0]>=0?this.setFlipX(!1):this.setFlipX(!0),this.setVelocityX(i[0]*t),this.setVelocityY(i[1]*t),this.depth=this.y}}class L extends D{constructor(e,t,s,i,n){super(e,t,s,i),this.clientName=n,this.dir=[0,0],this.textLabel=e.add.text(t,s,n,{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif',fontSize:"12px",align:"center",strokeThickness:4,stroke:x(C(i))})}update(e,t){this.knocked_out>0&&(this.knocked_out-=t/1e3,this.dir=[0,0]),super.update(e,t,this.dir),this.textLabel.setPosition(this.x-this.textLabel.width/2,this.y-this.getBounds().height/2-this.textLabel.height-5)}destroy(e){this.textLabel.destroy(),super.destroy(e)}}class G extends L{constructor(e,t,s,i,n,a=i){super(e,t,s,i,a),this.setInteractive(),this.cursors=n}playerControl(e,t){let s=[0,0];this.cursors.left.isDown?s[0]=-1:this.cursors.right.isDown&&(s[0]=1),this.cursors.up.isDown?s[1]=-1:this.cursors.down.isDown&&(s[1]=1);let i=this.scene.input.activePointer;return i.isDown&&(s[0]=i.x-this.x+this.scene.cameras.main.scrollX,s[1]=i.y-this.y),s}update(e,t){this.dir=this.playerControl(e,t),super.update(e,t)}}class j extends L{constructor(e,t,s){super(e,0,0,k(t.parti),t.clientName),s.onRemotePlayerMove(t.clientId,this.playerMoved.bind(this)),this.clientId=t.clientId}playerMoved(e,t){this.dir[0]=e,this.dir[1]=t}update(e,t){super.update(e,t)}}class B extends G{constructor(e,t,s,i,n){super(e,0,0,t,s,i),this.networkPlayerHandler=n}update(e,t){super.update(e,t),this.networkPlayerHandler.replicatePlayerMove(...this.dir)}}class z extends L{constructor(e,t,s,i){super(e,t,s,i,i),this.clientName=i,this.dir=[0,0],this.aiAction=0,console.log(`Created AI player "${this.clientName}"`)}aiControl(e,t){return this.aiAction<=0&&(this.dir=[1,n().Math.Between(-100,100)/100],this.aiAction=n().Math.Between(.3,1)),this.dir}update(e,t){this.knocked_out>0?this.knocked_out-=t/1e3:this.dir=this.aiControl(e,t),super.update(e,t)}}class F extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.goal=2500}init(e){console.log(`Starting a ${e.type} game.`),this.state=0,l.clearScreen(),this.WIDTH=this.sys.game.canvas.width,this.HEIGHT=this.sys.game.canvas.height,this.STREET_MAX_Y=this.HEIGHT-100,this.STREET_MIN_Y=170,this.cameras.main.setBounds(0,0,this.goal,this.HEIGHT,!0),this.riksdagen=new Phaser.Physics.Arcade.Group(this.physics.world,this),this.powerups=new Phaser.Physics.Arcade.Group(this.physics.world,this),this.hinder=new Phaser.Physics.Arcade.Group(this.physics.world,this),this.statist=new Phaser.Physics.Arcade.Group(this.physics.world,this),this.level=new M(this,this.goal,0,this.statist,this.hinder,this.powerups),this.vinnare=[];for(let e of Object.values(w))console.log(e),this.addOrReplaceLedamot(new z(this,S[e].x,S[e].y,e));"Multiplayer"===e.type?this.initMultiplayerGame(e):this.initSingleplayerGame(e)}addOrReplaceLedamot(e){let t=this.riksdagen.getMatching("key",e.key)[0];t&&t.destroy(),this.riksdagen.add(e),e.setCollideWorldBounds()}initSingleplayerGame(e){this.spelare=new G(this,0,0,k(e.player.parti),this.input.keyboard.createCursorKeys()),this.addOrReplaceLedamot(this.spelare)}initMultiplayerGame(e){for(const t of e.playersHandler.getConnectedPlayers()){const s=new j(this,t,e.playersHandler);this.addOrReplaceLedamot(s)}this.spelare=new B(this,k(e.player.parti),this.input.keyboard.createCursorKeys(),e.player.clientName,e.playersHandler),this.addOrReplaceLedamot(this.spelare),e.playersHandler.onRemovePlayer=e=>{console.log(`[MainScene] replacing ${e.clientName} with ai`);const t=this.riksdagen.getChildren().find((t=>t instanceof j&&t.clientId===e.clientId));if(t){const e=new z(this,t.x,t.y,t.key);e.setCollideWorldBounds(!0),t.destroy(),this.riksdagen.remove(t),this.riksdagen.add(e)}}}lineUpPlayers(){const e=this.riksdagen.getChildren().filter((e=>e instanceof L)),t=e.sort(((e,t)=>e.clientName.localeCompare(t.clientName))),s=(this.STREET_MAX_Y-this.STREET_MAX_Y)/e.length;console.log("[MainScene]",t.map((({key:e})=>e))),t.forEach(((e,t)=>{const{height:i}=e.getBounds();var n;e.y=this.STREET_MIN_Y-t*(s-i/2),e.x=(n=e.key)in S?S[n].x:0}))}create(){console.log("Main Scene"),this.physics.add.collider(this.riksdagen,this.hinder),this.lineUpPlayers(),this.state=4}update(e,t){if(4!==this.state)return;let s=0,i=this.cameras.main.worldView.x;this.physics.world.overlap(this.riksdagen,this.powerups,this.powerupCollision),this.physics.world.overlap(this.riksdagen,this.statist,this.statistCollision),this.riksdagen.children.each((n=>{n.update(e,t),0==this.vinnare.length&&n.x>s&&(s=n.x,this.cameras.main.centerOnX(s-150)),i>n.x&&this.riksdagen.remove(n,!0,!0),n.x>this.goal&&(this.vinnare.push(n),this.riksdagen.remove(n,!0,!0))})),this.riksdagen.getLength()<=0&&(this.state=5,this.scene.start("PostScene")),this.level.update(e,t,i+this.WIDTH)}powerupCollision(e,t){"peng"==t.key?e.max_speed+=20:"neddut"==t.key&&(e.max_speed-=20),t.destroy()}statistCollision(e,t){t.collidedWith(e)}riksdagskollision(e,t){e.punch&&(t.knocked_out=.7)}}var K=s(591),$=s(503);const W={apiKey:"AIzaSyCuZpzrSujOQCQ8cxkNtdw6Lmr5Vzbcux8",authDomain:"webrtc-test-af4df.firebaseapp.com",projectId:"webrtc-test-af4df",storageBucket:"webrtc-test-af4df.appspot.com",messagingSenderId:"520284588613",appId:"1:520284588613:web:8a739063aa2d749297b12c"},J=(()=>{const e=(0,$.ZF)(W);return{app:e,db:(0,K.ad)(e)}})();var V=s(729),U=s.n(V),X=s(586);class Y extends(U()){constructor(e=(0,X.Z)()){super(),this.clientId=e,this.channels={}}echoMessage(e,t){for(const[s,i]of Object.entries(this.channels))s!==t&&i.send(JSON.stringify(e))}setupChannel(e,t){e.onmessage=e=>{const s=JSON.parse(e.data);this.emit("game-data",s),this.isHost&&this.echoMessage(s,t)},e.onclose=()=>{console.log(`Channel ${t} closed!`)},e.onerror=e=>{console.error(`Channel ${t} error!`,e)},e.onopen=()=>{console.log(`Channel ${t} connected!`)},this.channels[t]=e}removeChannel(e){delete this.channels[e]}addPeerConnection(e,t){e.ondatachannel=e=>this.setupChannel(e.channel,t)}addHostConnection(e,t){const s=e.createDataChannel("DATA_CHANNEL");this.setupChannel(s,t)}sendData(e){for(const t of Object.values(this.channels))"open"===t.readyState&&t.send(JSON.stringify(Object.assign(Object.assign({},e),{senderId:this.clientId})))}lockRoom(){}addConnection(e,t){this.isHost?this.addHostConnection(e,t):this.addPeerConnection(e,t)}removeConnection(e){this.channels[e].close(),this.removeChannel(e)}connect(){throw new Error("Method not implemented.")}}const Z={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};class Q extends Y{constructor(e,t){super(t.id),this.clientName=e,this.clientDoc=t,this.connection=new RTCPeerConnection(Z),this.offerCandidates=(0,K.hJ)(this.clientDoc,"offerCandidates"),this.answerCandidates=(0,K.hJ)(this.clientDoc,"answerCandidates")}connect(){throw new Error("Method not implemented.")}}var q=function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};class ee extends Q{constructor(e){super("NOT_SET",e),this.setUpListeners()}setUpListeners(){this.connection.onicecandidate=({candidate:e})=>{e&&(0,K.ET)(this.offerCandidates,e.toJSON())},this.connection.oniceconnectionstatechange=()=>q(this,void 0,void 0,(function*(){if("connected"===this.connection.iceConnectionState){const e=(yield(0,K.QT)(this.clientDoc)).data();if(console.log("Peer connection established, data:",e),void 0===(null==e?void 0:e.clientName))return;this.clientName=e.clientName,this.emit("client-connected",{clientName:e.clientName,clientId:this.clientId,isHost:!1})}else"disconnected"===this.connection.iceConnectionState&&(console.log("Peer connection disconnected",this),this.emit("client-disconnected",{clientName:this.clientName,clientId:this.clientId,isHost:!1}))}))}connect(){return q(this,void 0,void 0,(function*(){console.log("Connecting to sub client "+this.clientId);const e=yield this.connection.createOffer();yield this.connection.setLocalDescription(e),yield(0,K.pl)(this.clientDoc,{offer:{sdp:e.sdp,type:e.type}}),(0,K.cf)(this.clientDoc,(e=>q(this,void 0,void 0,(function*(){const t=e.data();if(!this.connection.currentRemoteDescription&&(null==t?void 0:t.answer)){console.log("Got an answer");const e=new RTCSessionDescription(t.answer);yield this.connection.setRemoteDescription(e),console.log("Answer setup done")}})))),(0,K.cf)(this.answerCandidates,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());this.connection.addIceCandidate(t)}}))}))}))}}class te extends Y{constructor(e){super(),this.isHost=!0,this.isConnected=!1,this.clientName=e,this.openForConnections=!0}connect(){return q(this,void 0,void 0,(function*(){console.log("Connecting host client");const e=(0,K.JU)((0,K.hJ)(J.db,"rooms")),t=(0,K.hJ)(e,"clients");yield(0,K.pl)(e,{hostId:this.clientId,hostName:this.clientName}),this.roomId=e.id,this.isConnected=!0,this.emit("room-created",this.roomId),this.unsubscibeClients=(0,K.cf)(t,(e=>{e.docChanges().forEach((e=>{if("added"===e.type&&this.openForConnections){console.log("Client connected, setting up peer connection...");const t=e.doc.ref;this.createSubClient(t)}}))}))}))}lockRoom(){console.log("[HostClient] locked new connections"),this.openForConnections=!1,this.unsubscibeClients()}createSubClient(e){const t=new ee(e);t.addListener("client-connected",(e=>{this.emit("client-connected",e)})),t.addListener("client-disconnected",(e=>{this.removeConnection(e.clientId),this.emit("client-disconnected",e)})),this.addConnection(t.connection,t.clientId),t.connect()}}class se{constructor(e){this.onNewPlayer=()=>{},this.onRemovePlayer=()=>{},this.connectedPlayers={},this.networkClient=e,e.addListener("game-data",this.onGameData.bind(this)),e.isHost?this.setupAsHost():this.setupAsClient()}setupAsHost(){this.connectedPlayers[this.networkClient.clientId]={clientId:this.networkClient.clientId,clientName:this.networkClient.clientName,isHost:!0,onPlayerMove:()=>{},ready:!0},this.networkClient.addListener("client-connected",this.onClientConnected.bind(this)),this.networkClient.addListener("client-disconnected",this.onClientDisconnected.bind(this))}setupAsClient(){this.pingId=setInterval((()=>{this.networkClient.sendData({type:1,payload:[]})}),500)}onClientConnected({clientId:e,clientName:t,isHost:s}){console.log("[NetworkPlayersHandler] added new client"),this.connectedPlayers[e]={clientId:e,clientName:t,isHost:s,ready:!1,onPlayerMove:()=>{}}}onClientDisconnected(e){console.log("[NetworkPlayersHandler] player disconnected"),this.removeConnectedPlayer(e),this.networkClient.sendData({type:3,payload:e})}onGameData(e){switch(e.type){case 5:this.networkClient.isHost&&this.addPlayerCharacter(e);break;case 0:this.connectedPlayers[e.senderId].onPlayerMove(...e.payload);break;case 1:this.networkClient.sendData({type:2,payload:Object.values(this.connectedPlayers).filter((({parti:e})=>!!e)).map((({clientId:e,clientName:t,isHost:s,parti:i})=>({clientId:e,clientName:t,isHost:s,parti:i})))});break;case 2:this.addConnectedPlayers(e.payload);break;case 4:this.networkClient.isHost||clearInterval(this.pingId);break;case 3:this.removeConnectedPlayer(e.payload)}}removeConnectedPlayer(e){console.log("[NetworkPlayersHandler] player disconnected",e),delete this.connectedPlayers[e.clientId],this.onRemovePlayer(e)}addConnectedPlayers(e){for(const t of e)t.clientId in this.connectedPlayers?this.connectedPlayers[t.clientId]=Object.assign(Object.assign({},this.connectedPlayers[t.clientId]),t):(this.connectedPlayers[t.clientId]=Object.assign(Object.assign({},t),{ready:void 0!==t.parti,onPlayerMove:()=>{}}),console.log("[NetworkPlayersHandler] new player added",t),this.onNewPlayer(t))}addPlayerCharacter({senderId:e,payload:t}){if(!(e in this.connectedPlayers))throw new Error("Tried to add parti to player that is not connected!?");console.log("[NetworkPlayersHandler] added client parti",t),this.connectedPlayers[e].parti=t,this.connectedPlayers[e].ready=!0,this.onNewPlayer(this.connectedPlayers[e])}isAllReady(){return Object.values(this.connectedPlayers).every((({ready:e})=>e))}getConnectedPlayers(e=!0){return e?Object.values(this.connectedPlayers).filter((({clientId:e})=>this.networkClient.clientId!==e)):Object.values(this.connectedPlayers)}selectParti(e){this.networkClient.isHost&&(this.connectedPlayers[this.networkClient.clientId].parti=e),this.networkClient.sendData({type:5,payload:e})}replicatePlayerMove(e,t){this.networkClient.sendData({type:0,payload:[e,t]})}onRemotePlayerMove(e,t){this.connectedPlayers[e].onPlayerMove=t}}var ie=function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};class ne extends Q{constructor(e,t){const s=(0,K.JU)((0,K.hJ)(J.db,"rooms"),e),i=(0,K.hJ)(s,"clients");super(t,(0,K.JU)(i,(0,X.Z)())),this.roomId=e,this.clientsDoc=i,this.roomDoc=s,this.isHost=!1,this.setupListeners()}setupListeners(){this.connection.onicecandidate=({candidate:e})=>{e&&(0,K.ET)(this.answerCandidates,e.toJSON())},this.connection.oniceconnectionstatechange=()=>{"connected"===this.connection.iceConnectionState?(console.log(`Client ${this.clientId} connected to host`),this.isConnected=!0,this.emit("joined-room")):"disconnected"===this.connection.iceConnectionState&&(console.log(`Client ${this.clientId} disconnected`),this.isConnected=!1,this.removeConnection(this.clientId),this.emit("client-disconnected",{clientId:this.clientId,clientName:this.clientName,isHost:!1}))},this.addConnection(this.connection,this.clientId)}connect(){return ie(this,void 0,void 0,(function*(){console.log(`Connecting client ${this.clientId} to host`),yield(0,K.pl)(this.clientDoc,{clientName:this.clientName}),(0,K.cf)(this.clientDoc,(e=>ie(this,void 0,void 0,(function*(){const t=e.data();if(!t)return;if(!t.offer)return;if(t.answer)return;console.log(`Client ${this.clientId} found host`);const s=new RTCSessionDescription(t.offer);yield this.connection.setRemoteDescription(s);const i=yield this.connection.createAnswer();yield this.connection.setLocalDescription(i),yield(0,K.r7)(this.clientDoc,{answer:{sdp:i.sdp,type:i.type},clientName:this.clientName})})))),(0,K.cf)(this.offerCandidates,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){console.log(`Client ${this.clientId} found offer candidate`);const t=new RTCIceCandidate(e.doc.data());this.connection.addIceCandidate(t)}}))}))}))}}const ae=e=>({border:`5px solid ${e}`,backgroundColor:"transparent",color:e}),oe={borderRadius:"10px",margin:"0px",padding:"20px 30px",fontSize:"64px",fontWeight:"bold",cursor:"pointer",transition:"all .25s ease"};class re extends d{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){const s=document.createElement("input");s.placeholder=e,Object.assign(s.style,oe,ae(t)),s.addEventListener("focusin",(()=>Object.assign(s.style,(e=>({backgroundColor:e,color:"white"}))(t)))),s.addEventListener("focusout",(()=>Object.assign(s.style,ae(t)))),this.element=s}getValue(){return this.element.value.trim()}}class ce extends Phaser.Scene{constructor(){super({key:"ServerConnectionScene"})}create(){l.clearScreen();const e=new f,t=new re("Användarnamn","#06D6A0"),s=new re("Rumsid","#06D6A0"),i=new m("Skapa spel","#3185FC");i.onClick((()=>{const e=t.getValue();if(e){const t=new te(e),s={type:"Multiplayer",player:{clientId:t.clientId,clientName:t.clientName,isHost:!0},networkClient:t,playersHandler:new se(t)};t.once("room-created",(()=>{this.scene.start("CharSelectScene",s)})),t.connect()}}));const n=new m("Gå med i spel","#DB2763");n.onClick((()=>{const e=t.getValue(),i=s.getValue();if(e&&i){const t=new ne(i,e),s={type:"Multiplayer",player:{clientId:t.clientId,clientName:t.clientName,isHost:!1},networkClient:t,playersHandler:new se(t)};t.once("joined-room",(()=>{this.scene.start("CharSelectScene",s)})),t.connect()}})),e.setPosition({fromCenter:!0}),e.addElement(t,s,i,n),l.addElement(e)}}const le={type:Phaser.AUTO,backgroundColor:"#000000",pixelArt:!0,width:960,height:540,scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:960,height:540},scene:[r,c,ce,R,O,o,h,N,a,F],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:0}}}};window.addEventListener("load",(()=>{new Phaser.Game(le)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,n,a)=>{if(!s){var o=1/0;for(h=0;h<e.length;h++){for(var[s,n,a]=e[h],r=!0,c=0;c<s.length;c++)(!1&a||o>=a)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,a<o&&(o=a));if(r){e.splice(h--,1);var l=n();void 0!==l&&(t=l)}}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,n,a]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,a,[o,r,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(n in r)i.o(r,n)&&(i.m[n]=r[n]);if(c)var h=c(i)}for(t&&t(s);l<o.length;l++)a=o[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(h)},s=self.webpackChunkRiksloppet=self.webpackChunkRiksloppet||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(164)));var n=i.O(void 0,[216],(()=>i(204)));n=i.O(n)})();